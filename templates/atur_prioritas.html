{% extends 'dashboard.html' %}
{% block content %}
<h2 class="text-xl font-bold mb-4">Atur Prioritas Keuangan</h2>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class="mb-4">
      {% for message in messages %}
        <li class="bg-yellow-100 text-yellow-800 p-2 rounded">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<form method="POST">
  <div class="space-y-4">
    {% for i, item in enumerate(data, start=1) %}
    <div class="grid grid-cols-2 gap-4">
      <input type="text" name="kategori_{{ i }}" value="{{ item.kategori }}" placeholder="Kategori" class="border p-2 rounded w-full" required>
      <input type="number" name="persen_{{ i }}" value="{{ item.persentase }}" min="0" max="100" class="border p-2 rounded w-full" required>
    </div>
    {% endfor %}

    <div class="grid grid-cols-2 gap-4">
      <input type="text" name="kategori_new" placeholder="Kategori Baru" class="border p-2 rounded w-full">
      <input type="number" name="persen_new" placeholder="%" min="0" max="100" class="border p-2 rounded w-full">
    </div>

    <div class="text-right">
      <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">Simpan</button>
    </div>
  </div>
</form>

<hr class="my-6">
<p>Total persentase sebaiknya tidak melebihi 100%.</p>

<script>
  function hitungTotal() {
    let total = 0;
    document.querySelectorAll('input[name^="persen_"]').forEach(input => {
      total += parseInt(input.value || 0);
    });
    let newVal = document.querySelector('input[name="persen_new"]').value;
    if (newVal) total += parseInt(newVal);

    const warna = total > 100 ? 'text-red-600' : 'text-green-600';
    document.getElementById('totalPersen').innerHTML = `<strong class="${warna}">${total}%</strong>`;
  }

  document.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', hitungTotal);
  });
  window.onload = hitungTotal;
</script>

<p>Total Saat Ini: <span id="totalPersen" class="font-bold"></span></p>
{% endblock %}
